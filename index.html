<html>
	<head>
		<!--<script type="text/javascript" src="./jquery-1.11.1.min.js"></script>-->
	</head>
	<body>
		<div id="list_m"></div>
		<audio id="player" controls>
			<!--<source src="./mp3/M1.mp3" type="audio/mpeg">
			<source src="./mp3/M10.mp3" type="audio/mpeg">-->
		Your browser does not support the audio element.
		</audio>
		<br>
		<button onclick="play();">Play</button>
		<button onclick="playFile(5);">Play</button>
		<br>
		<textarea id="debug" rows="20" cols="100"></textarea>
		<script type="text/javascript">
			// Constants
			var dir = "./mp3/";
			var ext = ".mp3"
			var player = document.getElementById('player');
			var list_m = document.getElementById('list_m');
			
			// Variables
			var playlist = new Array(5, 10, 103, 29);
			var playing = -1; // index current playing song in playlist
			var file = undefined; // name of current playing file
			
			// Functions
			function debug(text) {
				var debugging = document.getElementById('debug');
				if(debugging.innerHTML != '') debugging.innerHTML += '\n';
				debugging.innerHTML += text;
			}
			
			function playFile(id) {
				if(id == undefined || id == '') {
					alert("ERROR: Empty filename to play!");
					return;
				}
				if(player == null) {
					alert("ERROR: Player element not found!");
					return;
				}
				if(file == id) {
					player.play();
				} else {
					playerClean();
					playerAddFile(id);
					player.play();
				}
			}
			
			function playerClean() {
				if(player == null) {
					alert("ERROR: Player element not found!");
					return;
				}
				debug("playerClean()");
				player.innerHTML = '';
				player.load();
			}
			
			function playerAddFile(id) {
				if(player == null) {
					alert("ERROR: Player element not found!");
					return;
				}
				file = dir+id+ext;
				debug("playerAddFile("+id+"):"+file);
				player.innerHTML = "<source src=\""+file+"\" type=\"audio/mpeg\">";
				player.load();
			}
			
			function play() {
				debug("play():");
				if(playlist.length == 0) {
					alert("ERROR: Empty playlist!");
					return;
				}
				debug("\tplaylist["+playlist.length+"]: "+playlist.toString());
				if(player == null) {
					alert("ERROR: Player element not found!");
					return;
				}
				
				debug("\tplayer: ");
				debug("\t\tpaused: "+player.paused);
				debug("\t\tended: "+player.ended);
				if(player.audioTracks.length == 0) {
					if(playing == playlist.length -1 ) { // Last song played
						playing = 0;
					}
				}
				player.play();
			}

			function init_m() {
				var max = 176;
				var cols = 16;

				if(list_m == null) {
					alert("ERROR: list_m not found!");
					return;
				}
				
				var html = '';
				html += '<table border="1">'
				for(i = 1; i <= max; i++) {
					if((i-1) % cols == 0) html += '<tr>';
					html += "<td><button onclick=\"playFile('M"+i+"')\">"+i+"</button></td>";
					if(i % cols == 0) html += '</tr>';
				}
				html += '</table>'
				list_m.innerHTML = html;
			}

			init_m();
			
			/*$(document).ready(function() {
				
			});*/
		</script>
	</body>
</html>
